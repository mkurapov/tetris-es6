!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Tetris",[],e):"object"==typeof exports?exports.Tetris=e():t.Tetris=e()}(this,function(){return function(t){function e(i){if(r[i])return r[i].exports;var o=r[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),n=r(1),a={ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},s={E:"white",B:"#8CA4D4",O:"#FDCDA7",P:"#C2A1DA",R:"#EF8B8B",Y:"#FAF1A2",C:"#D6E9F8",G:"#C5D9A6"},c=function(){function t(e){var r=this;i(this,t),this.canvas=e,this.rows=20,this.columns=10,this.canvas.height=window.innerHeight,this.canvas.width=window.innerHeight/2,this.scaleFactor=this.canvas.height/this.rows,this.ctx=e.getContext("2d"),this.speed=3,this.score=0,this.gameBoard=[],this.currentTet={},this.resetGameBoard(),document.addEventListener("keydown",function(t){return r.keyDown(t)},!1),window.addEventListener("resize",function(t){return r.resizeCanvas(t)},!1)}return o(t,[{key:"resetGameBoard",value:function(){this.gameBoard=[];for(var t=0;t<this.rows;t++){var e=Array(this.columns).fill("E");this.gameBoard.push(e)}this.score=0,this.renderGameBoard()}},{key:"resizeCanvas",value:function(t){this.canvas.height=window.innerHeight,this.canvas.width=window.innerHeight/2,this.scaleFactor=this.canvas.height/this.rows,this.renderGameBoard()}},{key:"drawRect",value:function(t,e,r){var i=t*this.scaleFactor,o=e*this.scaleFactor;this.ctx.fillStyle=r,this.ctx.fillRect(i,o,this.scaleFactor,this.scaleFactor),this.ctx.strokeStyle="white",this.ctx.lineWidth=.5,this.ctx.strokeRect(i,o,this.scaleFactor,this.scaleFactor)}},{key:"drawScore",value:function(){this.ctx.font=.8*this.scaleFactor+"px Karla",this.ctx.fillStyle="#aaaaaa",this.ctx.textAlign="right",this.ctx.fillText(this.score,9.3*this.scaleFactor,1.3*this.scaleFactor)}},{key:"renderGameBoard",value:function(){for(var t=0;t<this.rows;t++)for(var e=0;e<this.columns;e++){var r=s[this.gameBoard[t][e]];this.drawRect(e,t,r)}this.drawScore()}},{key:"redrawPiece",value:function(){this.insertTetromino(),this.renderGameBoard()}},{key:"validMove",value:function(t){for(var e=t.matrix.length,r=0;r<e;r++)for(var i=0;i<e;i++){var o=t.x+i,n=t.y+r;if("E"!==t.matrix[r][i])try{var a=this.gameBoard[n][o];if("E"!==a||o===this.columns)throw new Error("hit something")}catch(s){return!1}}return!0}},{key:"clearTetromino",value:function(){for(var t=this.currentTet.matrix.length,e=0;e<t;e++)for(var r=0;r<t;r++){var i=this.currentTet.x+r,o=this.currentTet.y+e;"E"!==this.currentTet.matrix[e][r]&&(this.gameBoard[o][i]="E")}}},{key:"insertTetromino",value:function(){for(var t=this.currentTet.matrix.length,e=0;e<t;e++)for(var r=0;r<t;r++){var i=this.currentTet.x+r,o=this.currentTet.y+e;"E"!==this.currentTet.matrix[e][r]&&(this.gameBoard[o][i]=this.currentTet.matrix[e][r])}}},{key:"handleRotation",value:function(){this.clearTetromino();var t=new n.Tetromino;t.x=this.currentTet.x,t.y=this.currentTet.y,t.matrix=this.currentTet.matrix,t.orientation=this.currentTet.orientation,t.rotate(),this.validMove(t)&&this.bottomEmpty(t)&&this.currentTet.rotate(),this.redrawPiece()}},{key:"bottomEmpty",value:function(t){for(var e=t.matrix.length,r=0;r<e;r++)for(var i=0;i<e;i++){var o=t.x+i,n=t.y+r+1;if("E"!==t.matrix[r][i])try{var a=this.gameBoard[n][o];if("E"!==a)return!1}catch(s){return!1}}return!0}},{key:"checkRows",value:function(){for(var t=this.gameBoard,e=this.rows-1;e>=0;e--){var r=t[e].filter(function(t){return"E"===t});if(0===r.length){this.gameBoard.splice(e,1);var i=Array(this.columns).fill("E");this.gameBoard.unshift(i),this.score+=100,e++}}this.renderGameBoard()}},{key:"spawnTetromino",value:function(){this.checkRows(),this.score+=10;var t=[new n.TetrominoI,new n.TetrominoJ,new n.TetrominoL,new n.TetrominoS,new n.TetrominoZ,new n.TetrominoO,new n.TetrominoT],e=t[Math.floor(Math.random()*t.length)];this.validMove(e)||this.resetGameBoard(),this.currentTet=e,this.insertTetromino()}},{key:"makeMove",value:function(t){this.clearTetromino();var e=new n.Tetromino;switch(e.x=this.currentTet.x,e.y=this.currentTet.y,e.matrix=this.currentTet.matrix,t){case a.DOWN:e.moveDown(),this.validMove(e)&&this.currentTet.moveDown();break;case a.RIGHT:e.moveRight(),this.validMove(e)&&this.currentTet.moveRight();break;case a.LEFT:e.moveLeft(),this.validMove(e)&&this.currentTet.moveLeft()}this.bottomEmpty(this.currentTet)?this.redrawPiece():(this.insertTetromino(),this.spawnTetromino())}},{key:"keyDown",value:function(t){switch(t.keyCode){case a.UP:this.handleRotation();break;case a.DOWN:this.makeMove(a.DOWN);break;case a.RIGHT:this.makeMove(a.RIGHT);break;case a.LEFT:this.makeMove(a.LEFT)}}},{key:"run",value:function(){var t=this;this.currentTet=new n.TetrominoL,this.insertTetromino(),this.renderGameBoard(),window.animateLoop=function(){setTimeout(function(){requestAnimationFrame(animateLoop),t.makeMove(a.DOWN),t.renderGameBoard()},1e3/t.speed)},animateLoop()}}]),t}();e["default"]=c,t.exports=e["default"]},function(t,e){"use strict";function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=e.Tetromino=function(){function t(){o(this,t),this.orientation="u",this.matrix=[],this.x=3,this.y=1}return n(t,[{key:"rotate",value:function(){for(var t=this.matrix.length,e=Array(t).fill().map(function(){return[]}),r=0;r<t;r++)for(var i=0;i<t;i++)e[r][i]=this.matrix[t-i-1][r];this.matrix=e,e=[],this.updateOrientation()}},{key:"updateOrientation",value:function(){var t=["u","r","d","l"],e=this.orientation,r=(t.indexOf(e)+1)%4;this.orientation=t[r]}},{key:"moveRight",value:function(){this.x+=1}},{key:"moveLeft",value:function(){this.x-=1}},{key:"moveDown",value:function(){this.y+=1}}]),t}();e.TetrominoL=function(t){function e(){o(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.colour="B",t.matrix=[["B","E","E"],["B","B","B"],["E","E","E"]],t}return i(e,t),e}(a),e.TetrominoJ=function(t){function e(){o(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.colour="J",t.matrix=[["E","E","O"],["O","O","O"],["E","E","E"]],t}return i(e,t),e}(a),e.TetrominoZ=function(t){function e(){o(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.colour="R",t.matrix=[["R","R","E"],["E","R","R"],["E","E","E"]],t}return i(e,t),e}(a),e.TetrominoS=function(t){function e(){o(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.colour="G",t.matrix=[["E","G","G"],["G","G","E"],["E","E","E"]],t}return i(e,t),e}(a),e.TetrominoI=function(t){function e(){o(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.colour="C",t.matrix=[["E","E","E","E"],["C","C","C","C"],["E","E","E","E"],["E","E","E","E"]],t}return i(e,t),e}(a),e.TetrominoO=function(t){function e(){o(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.colour="Y",t.matrix=[["Y","Y"],["Y","Y"]],t}return i(e,t),n(e,[{key:"rotate",value:function(){}}]),e}(a),e.TetrominoT=function(t){function e(){o(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.colour="P",t.matrix=[["P","P","P"],["E","P","E"],["E","E","E"]],t}return i(e,t),e}(a)}])});
//# sourceMappingURL=Tetris.min.js.map